# Documentation: generate_questions.py

## Overview
This script generates questions related to documents from the Official Journal of the Federation (DOF) using Google's Gemini language model. It randomly selects a markdown file containing DOF content, generates questions based on its content, and saves them to a CSV file.

## Dependencies
- `os`: For operating system interaction
- `random`: For random file selection
- `typer`: For creating the command-line interface
- `getpass`: For secure API key input
- `pathlib`: For file path manipulation
- `datetime`: For timestamps on generated questions
- `dotenv`: For loading environment variables
- `google.generativeai`: Google AI (Gemini) API client
- `csv`: For CSV file manipulation
- `io`: For in-memory input/output operations

## Configuration
- Uses a `.env` file to load the Google API key
- Configures the Gemini client with the API key

## Functionalities

### Directory Resolution
The `resolve_base_dir()` function attempts to find the specified directory:
- First looks in the current working directory
- If not found, searches relative to the script location
- Terminates execution if the directory doesn't exist

### Finding Markdown Files
The `find_md_files()` function:
- Recursively traverses the specified directory
- Looks for `.md` files whose names follow the DDMMYYYY-* format
- Filters only those files corresponding to DOF 2024 or 2025

### Processing Gemini Responses
The `parse_csv_from_gemini()` function:
- Receives the text generated by Gemini
- Removes lines with code markers (```)
- Parses the content as CSV
- Returns a list of rows

### Generating Questions
The `generate_questions()` function:
- Reads the markdown file content
- Builds a prompt for Gemini requesting questions in CSV format
- Uses the "gemini-2.0-flash" model
- Processes and limits the number of generated questions

### Main Command
The `main()` command:
1. Resolves the base directory
2. Finds DOF 2024/2025 markdown files
3. Selects a random file
4. Generates questions based on that file
5. Writes the questions to a CSV file, adding a timestamp

## Parameters
- `directory` (required): Path to the directory containing DOF markdown files
- `output_csv` (optional): Path to the output CSV file (default: "questions.csv")
- `num_questions` (optional): Number of questions to generate (default: 5)

## Output Format
The generated CSV file contains the following columns:
- `RunTimestamp`: ISO 8601 timestamp of execution
- `Question`: Generated question
- `File`: Source filename
- `Page`: Page number (if available)
- `Extract`: Text extract relevant to the question

## Implementation Notes
The script is designed to work in "append" mode, adding new questions to the existing CSV file without duplicating headers. Each set of questions is identified with a unique timestamp (RunID). The Gemini model is configured to generate simple questions based on the document content, along with the contextual information needed to validate answers.

## Command-Line Usage
```bash
python generate_questions.py dof_markdown --output questions.csv --num 10
```
This will generate 10 questions based on a random file from the dof_markdown folder and save them to questions.csv. 